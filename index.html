<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VATS AI AGENT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            overflow-x: hidden;
            color: #ffffff;
            background-color: #0a0a1a;
        }

        #spaceCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Header Styles */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            z-index: 10;
            backdrop-filter: blur(5px);
        }

        .vats-mega-title {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(90deg, #00C9FF 0%, #92FE9D 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(0, 201, 255, 0.5);
            letter-spacing: 3px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 100px auto 20px;
            padding: 20px;
            position: relative;
            z-index: 1;
            display: flex;
            gap: 20px;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            background: rgba(20, 20, 40, 0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 140px);
        }

        .chat-header {
            padding: 15px;
            background: rgba(30, 30, 60, 0.7);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: rgba(0, 201, 255, 0.3);
            transform: scale(1.1);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            line-height: 1.6;
            animation: fadeIn 0.3s ease;
            position: relative;
        }

        .user-message {
            background: rgba(0, 150, 255, 0.2);
            border-left: 4px solid #0096ff;
            margin-left: 20%;
        }

        .ai-message {
            background: rgba(100, 255, 200, 0.1);
            border-left: 4px solid #64ffc8;
            margin-right: 20%;
        }

        .message-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
            gap: 5px;
        }

        .message:hover .message-actions {
            display: flex;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .action-btn:hover {
            background: rgba(0, 201, 255, 0.5);
        }

        .input-area {
            display: flex;
            padding: 15px;
            background: rgba(30, 30, 60, 0.7);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        #userInput {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            outline: none;
            padding-right: 40px;
        }

        .input-actions {
            position: absolute;
            right: 85px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
        }

        .input-action-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }

        .input-action-btn:hover {
            color: #00C9FF;
            transform: scale(1.1);
        }

        #sendBtn {
            margin-left: 10px;
            padding: 0 20px;
            background: linear-gradient(90deg, #00C9FF, #92FE9D);
            border: none;
            border-radius: 8px;
            color: #111;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #sendBtn:hover {
            transform: translateY(-2px);
        }

        /* Code Blocks */
        .code-block {
            background: #1e1e2e;
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            background: #2a2a3a;
            color: #aaa;
            font-size: 14px;
            font-family: monospace;
        }

        .code-actions {
            display: flex;
            gap: 8px;
        }

        .code-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .copy-btn {
            background: #3a3a5a;
            color: white;
        }

        .copy-btn:hover {
            background: #4a4a6a;
        }

        .run-btn {
            background: #00aa55;
            color: white;
        }

        .run-btn:hover {
            background: #00bb66;
        }

        pre {
            margin: 0;
            padding: 15px;
            overflow-x: auto;
        }

        code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #f8f8f2;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: inline-block;
            padding-left: 5px;
        }

        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #64ffc8;
            border-radius: 50%;
            margin-right: 3px;
            animation: typingAnimation 1.4s infinite both;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        /* Theme Switcher */
        .theme-switcher {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(30, 30, 60, 0.8);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* Animations */
        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(0, 201, 255, 0.5); }
            to { text-shadow: 0 0 20px rgba(0, 201, 255, 0.8), 0 0 30px rgba(146, 254, 157, 0.5); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .vats-mega-title {
                font-size: 2rem;
            }

            .container {
                margin-top: 80px;
                padding: 10px;
            }

            .chat-area {
                height: calc(100vh - 100px);
            }

            .user-message {
                margin-left: 10%;
            }

            .ai-message {
                margin-right: 10%;
            }

            .input-actions {
                right: 75px;
            }
        }

        /* Light Theme */
        body.light-theme {
            color: #333;
            background-color: #f5f5f5;
        }

        body.light-theme .chat-area,
        body.light-theme .chat-header,
        body.light-theme .input-area {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        body.light-theme #userInput {
            background: rgba(0, 0, 0, 0.05);
            color: #333;
        }

        body.light-theme .message {
            color: #333;
        }

        body.light-theme .user-message {
            background: rgba(0, 150, 255, 0.1);
        }

        body.light-theme .ai-message {
            background: rgba(100, 255, 200, 0.1);
        }

        body.light-theme .code-block {
            background: #f0f0f0;
        }

        body.light-theme .code-header {
            background: #e0e0e0;
            color: #666;
        }

        body.light-theme code {
            color: #333;
        }
    </style>
</head>
<body>
    <canvas id="spaceCanvas"></canvas>
    
    <div class="main-header">
        <h1 class="vats-mega-title">VATS AI</h1>
    </div>

    <div class="container">
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-title">VATS AI Assistant - Powered by BALAJI</div>
                <div class="chat-controls">
                    <button class="control-btn" id="newChatBtn" title="New Chat">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="control-btn" id="fullscreenBtn" title="Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="control-btn" id="voiceInputBtn" title="Voice Input">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
            <div class="chat-history" id="chatHistory">
                <!-- Messages will appear here -->
            </div>
            <div class="input-area">
                <input type="text" id="userInput" placeholder="Ask VATS AI anything...">
                <div class="input-actions">
                    <button class="input-action-btn" id="attachFileBtn" title="Attach File">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="input-action-btn" id="emojiBtn" title="Insert Emoji">
                        <i class="far fa-smile"></i>
                    </button>
                </div>
                <button id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="theme-switcher" id="themeSwitcher">
        <i class="fas fa-moon"></i>
    </div>

    <script>
        // ======================
        // 3D Space Background
        // ======================
        const canvas = document.getElementById('spaceCanvas');
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 30;
        
        // Galaxy
        const galaxyGeometry = new THREE.BufferGeometry();
        const starCount = 5000;
        const positions = new Float32Array(starCount * 3);
        const colors = new Float32Array(starCount * 3);
        const sizes = new Float32Array(starCount);
        
        for (let i = 0; i < starCount; i++) {
            const i3 = i * 3;
            
            // Position stars in a spiral galaxy pattern
            const radius = Math.random() * 100;
            const angle = Math.random() * Math.PI * 2;
            const spiralFactor = radius / 10;
            
            positions[i3] = Math.cos(angle + spiralFactor) * radius;
            positions[i3 + 1] = (Math.random() - 0.5) * 10;
            positions[i3 + 2] = Math.sin(angle + spiralFactor) * radius;
            
            // Random colors with more blue/white stars
            colors[i3] = 0.8 + Math.random() * 0.2;
            colors[i3 + 1] = 0.8 + Math.random() * 0.2;
            colors[i3 + 2] = 0.9 + Math.random() * 0.1;
            
            sizes[i] = 0.1 + Math.random() * 0.5;
        }
        
        galaxyGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        galaxyGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        galaxyGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
        
        const starMaterial = new THREE.PointsMaterial({
            size: 0.1,
            vertexColors: true,
            transparent: true,
            opacity: 0.8,
            sizeAttenuation: true
        });
        
        const galaxy = new THREE.Points(galaxyGeometry, starMaterial);
        scene.add(galaxy);
        
        // Sun
        const sunGeometry = new THREE.SphereGeometry(2, 32, 32);
        const sunMaterial = new THREE.MeshBasicMaterial({
            color: 0xffff00,
            emissive: 0xffff00,
            emissiveIntensity: 1
        });
        const sun = new THREE.Mesh(sunGeometry, sunMaterial);
        scene.add(sun);
        
        // Planets
        function createPlanet(size, color, distance, ring = false) {
            const group = new THREE.Group();
            const geometry = new THREE.SphereGeometry(size, 32, 32);
            const material = new THREE.MeshPhongMaterial({ color });
            const planet = new THREE.Mesh(geometry, material);
            
            planet.position.x = distance;
            group.add(planet);
            
            if (ring) {
                const ringGeometry = new THREE.RingGeometry(size * 1.5, size * 2, 32);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0xaaaaaa,
                    side: THREE.DoubleSide,
                    opacity: 0.6,
                    transparent: true
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                group.add(ring);
            }
            
            scene.add(group);
            return group;
        }
        
        const planets = [
            createPlanet(0.4, 0xaaaaaa, 5),  // Mercury
            createPlanet(0.6, 0xffcc66, 8),  // Venus
            createPlanet(0.6, 0x6699ff, 11), // Earth
            createPlanet(0.5, 0xff3333, 14), // Mars
            createPlanet(1.2, 0xffcc99, 18, true), // Jupiter with ring
            createPlanet(1.0, 0xffff99, 23, true), // Saturn with ring
            createPlanet(0.8, 0x99ffff, 28), // Uranus
            createPlanet(0.8, 0x6666ff, 33)  // Neptune
        ];
        
        // Animation
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotate galaxy and planets
            galaxy.rotation.y += 0.0005;
            
            planets.forEach((planet, index) => {
                planet.rotation.y += 0.01;
                const speed = 0.002 + (index * 0.0005);
                planet.rotation.y += speed;
                planet.children[0].position.x = Math.cos(Date.now() * speed) * (5 + index * 4);
                planet.children[0].position.z = Math.sin(Date.now() * speed) * (5 + index * 4);
            });
            
            renderer.render(scene, camera);
        }
        
        animate();
        
        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // ======================
        // Chat Interface
        // ======================
        const chatHistory = document.getElementById('chatHistory');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const newChatBtn = document.getElementById('newChatBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const voiceInputBtn = document.getElementById('voiceInputBtn');
        const attachFileBtn = document.getElementById('attachFileBtn');
        const emojiBtn = document.getElementById('emojiBtn');
        const themeSwitcher = document.getElementById('themeSwitcher');
        
        // Initial greeting
        addMessage("Hello! I'm VATS AI. How can I assist you today?", false);
        
        // Function to add a message to the chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            // Process content to detect code blocks
            const processedContent = processContent(content);
            messageDiv.innerHTML = isUser ? processedContent : `<strong>VATS AI:</strong> ${processedContent}`;
            
            // Add message actions
            if (!isUser) {
                const messageActions = document.createElement('div');
                messageActions.className = 'message-actions';
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'action-btn';
                copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                copyBtn.title = 'Copy';
                copyBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(content);
                    copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                    }, 2000);
                });
                
                const likeBtn = document.createElement('button');
                likeBtn.className = 'action-btn';
                likeBtn.innerHTML = '<i class="far fa-thumbs-up"></i>';
                likeBtn.title = 'Like';
                likeBtn.addEventListener('click', () => {
                    likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i>';
                    likeBtn.style.color = '#00C9FF';
                });
                
                messageActions.appendChild(copyBtn);
                messageActions.appendChild(likeBtn);
                messageDiv.appendChild(messageActions);
            }
            
            chatHistory.appendChild(messageDiv);
            
            // Scroll to bottom
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
// Function to process content and detect code blocks
function processContent(content) {
    // Simple markdown-style code block detection (```language\ncode\n```)
    const codeBlockRegex = /```(\w+)?\n([\s\S]+?)\n```/g;
    
    let result = '';
    let lastIndex = 0;
    let match;
    
    while ((match = codeBlockRegex.exec(content)) !== null) {
        // Add text before the code block
        result += content.slice(lastIndex, match.index);
        
        const language = match[1] || 'text';
        const code = match[2];
        
        // Escape HTML special characters in code
        const escapedCode = code
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
        
        // Create code block HTML with unique ID
        const blockId = 'codeblock-' + Math.random().toString(36).substr(2, 9);
        result += `
            <div class="code-block" id="${blockId}">
                <div class="code-header">
                    <span>${language.toUpperCase()}</span>
                    <div class="code-actions">
                        <button class="code-btn copy-btn" onclick="copyCode('${blockId}')">Copy</button>
                        ${language.toLowerCase() === 'html' ? 
                          `<button class="code-btn run-btn" onclick="runCode('${blockId}')">Run</button>` : ''}
                    </div>
                </div>
                <pre><code>${escapedCode}</code></pre>
            </div>
        `;
        
        lastIndex = match.index + match[0].length;
    }
    
    // Add remaining text after last code block
    result += content.slice(lastIndex);
    
    return result;
}

// Helper functions for code block actions
function copyCode(blockId) {
    const code = document.getElementById(blockId).querySelector('code').textContent;
    navigator.clipboard.writeText(code);
    
    // Update button text temporarily
    const btn = document.getElementById(blockId).querySelector('.copy-btn');
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy', 2000);
}

function runCode(blockId) {
    const code = document.getElementById(blockId).querySelector('code').textContent;
    const newWindow = window.open('', '_blank');
    newWindow.document.write(code);
    newWindow.document.close();
}
        
        // Function to show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            const typingText = document.createElement('div');
            typingText.innerHTML = `<strong>VATS AI:</strong> <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>`;
            
            typingDiv.appendChild(typingText);
            chatHistory.appendChild(typingDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        // Function to hide typing indicator
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Function to send message to OpenRouter API
        async function sendToAI(message) {
    const apiKey = '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'; // Replace with your actual API key
    const model = 'meta-llama/llama-4-maverick';
    
    try {
        showTypingIndicator();
        
        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json',
                'HTTP-Referer': window.location.href,
                'X-Title': 'VATS AGENT AI'
            },
            body: JSON.stringify({
                model: model,
                messages: [
                    {
                        role: "system",
                        content: "You are VATS AGENT AI, an advanced AI assistant created by Balaji and the VATS team. You are helpful, knowledgeable, and can assist with coding, answering questions, and more. When asked 'who made you' or similar questions, respond with 'Balaji made me and I'm part of the VATS team.' When providing code examples, format them properly with syntax highlighting."
                    },
                    ...getMessageHistory(),
                    {
                        role: "user",
                        content: message
                    }
                ]
            })
        });
        
        const data = await response.json();
        hideTypingIndicator();
        
        if (data.choices && data.choices[0].message.content) {
            addMessage(data.choices[0].message.content, false);
        } else {
            addMessage("I encountered an error processing your request. Please try again.", false);
        }
    } catch (error) {
        hideTypingIndicator();
        addMessage("Sorry, I'm having trouble connecting to the AI service. Please check your connection and try again.", false);
        console.error('API Error:', error);
    }
}
        
        // Function to get message history in OpenRouter format
        function getMessageHistory() {
            const messages = [];
            const messageElements = chatHistory.querySelectorAll('.message');
            
            messageElements.forEach(el => {
                if (el.id !== 'typingIndicator') {
                    const isUser = el.classList.contains('user-message');
                    let content = el.textContent.replace('VATS AI:', '').trim();
                    
                    // For AI messages with code blocks, we need to reconstruct the original markdown
                    const codeBlocks = el.querySelectorAll('.code-block');
                    codeBlocks.forEach(block => {
                        const lang = block.querySelector('.code-header span').textContent.toLowerCase();
                        const code = block.querySelector('code').textContent;
                        content = content.replace(block.textContent, `\`\`\`${lang}\n${code}\n\`\`\``);
                    });
                    
                    messages.push({
                        role: isUser ? "user" : "assistant",
                        content: content
                    });
                }
            });
            
            return messages;
        }
        
        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        newChatBtn.addEventListener('click', () => {
            chatHistory.innerHTML = '';
            addMessage("Hello! I'm VATS AI. How can I assist you today?", false);
        });
        
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
            } else {
                document.exitFullscreen();
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
            }
        });
        
        voiceInputBtn.addEventListener('click', () => {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.lang = 'en-US';
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    voiceInputBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                    voiceInputBtn.style.color = '#ff4d4d';
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    userInput.value = transcript;
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech recognition error', event.error);
                };
                
                recognition.onend = () => {
                    voiceInputBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    voiceInputBtn.style.color = '';
                };
                
                recognition.start();
            } else {
                alert('Speech recognition not supported in your browser');
            }
        });
        
        attachFileBtn.addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.txt,.pdf,.doc,.docx,.jpg,.png';
            
            fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        addMessage(`[Attached file: ${file.name}]`, true);
                        // In a real app, you would process the file content here
                    };
                    
                    reader.readAsText(file);
                }
            };
            
            fileInput.click();
        });
        
        themeSwitcher.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            const icon = themeSwitcher.querySelector('i');
            if (document.body.classList.contains('light-theme')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        });
        
        function sendMessage() {
            const message = userInput.value.trim();
            if (message) {
                addMessage(message, true);
                userInput.value = '';
                sendToAI(message);
            }
        }
    </script>
</body>
</html>